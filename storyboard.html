<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="PanelForge Storyboard - Arrange and review panels, thumbnails and loading placeholders for your comic storyboard.">
    <meta name="keywords" content="storyboard, comic panels, thumbnails, panel editor, PanelForge">
    <link rel="canonical" href="https://panelforge.com/storyboard">
    <title>Storyboard - PanelForge</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    
</head>
<body>
    <a href="#main" class="skip-link">Skip to main content</a>

    <div class="glow-curve curve-1"></div>
    <div class="glow-curve curve-2"></div>
    <div class="glow-curve curve-3"></div>

    <header class="pf-header" data-pf="header" role="banner" aria-label="Site header">
        <div class="header-container">
            <a href="index.html" class="logo" aria-label="PanelForge Home">Panel<span>Forge</span></a>

            <nav class="pf-nav" data-pf="nav" role="navigation" aria-label="Main navigation">
                <button class="mobile-menu-toggle pf-mobile-toggle" data-pf="mobile-toggle" aria-expanded="false" aria-controls="pf-mobile-menu" aria-label="Toggle navigation menu">
                    ?
                </button>
                <ul class="nav-menu pf-mobile-menu" id="pf-mobile-menu" role="menu" aria-hidden="true">
                    <li><a class="nav-link pf-nav-link" data-pf="nav-link" data-nav-key="home" href="index.html">Home</a></li>
                    <li><a class="nav-link pf-nav-link" data-pf="nav-link" data-nav-key="create" href="create.html">Create</a></li>
                    <li><a class="nav-link pf-nav-link" data-pf="nav-link" data-nav-key="studio" href="studio.html">Studio</a></li>
                    <li><a class="nav-link pf-nav-link active" data-pf="nav-link" data-nav-key="storyboard" href="storyboard.html" aria-current="page">Storyboard</a></li>
                    <li><a class="nav-link pf-nav-link" data-pf="nav-link" data-nav-key="preview" href="preview.html">Preview</a></li>
                    <li><a class="nav-link pf-nav-link" data-pf="nav-link" data-nav-key="export" href="export.html">Export</a></li>
                </ul>
                <div class="nav-actions" role="group" aria-label="Header actions">
                    <button class="btn-regenerate-top" title="Regenerate">Regenerate</button>
                </div>
            </nav>
        </div>
    </header>

    <main id="main" class="pf-main" data-pf="main" role="main">
        <div class="container">
            <div class="storyboard-layout">
                <div class="storyboard-panel" aria-labelledby="storyboard-heading">
                    <h1 id="storyboard-heading" style="font-size:1.1rem; font-weight:700; margin-bottom:0.75rem;">Storyboard</h1>

                    <div class="storyboard-controls">
                        <div class="left-controls">
                            <div class="zoom-controls" role="group" aria-label="Zoom controls">
                                <button class="zoom-btn" aria-label="Fit to screen">?</button>
                                <button class="zoom-btn" aria-label="Zoom out">?</button>
                                <button class="zoom-btn" aria-label="Zoom in">+</button>
                            </div>
                            <div style="width:8px;"></div>
                            <div class="page-actions">
                                <button class="btn-regenerate-page" title="Regenerate storyboard">
                                    <span>?</span>
                                    <span style="margin-left:6px;">Regenerate</span>
                                </button>
                                <button class="btn-toggle-loading" title="Toggle loading placeholders" aria-pressed="false">?</button>
                                <button class="btn-download" title="Download storyboard" aria-label="Download">?</button>
                            </div>
                        </div>

                        <div style="display:flex; align-items:center; gap:0.75rem;">
                            <div style="color:rgba(255,255,255,0.7); font-weight:600; font-size:0.95rem;">Page 1</div>
                        </div>
                    </div>

                    <!-- Top thumbnail strip (repeatable comic tiles per design) -->
                    <div class="thumbnail-strip-top pf-grid" data-pf="grid" aria-label="Panel thumbnails">
                        <div class="thumb-tile pf-card" data-thumb="1" data-card-id="1" title="Panel A">
                            <img src="https://im.runware.ai/image/ws/2/ii/0a56d500-319c-4650-a3f8-b60427281d4f.jpg" alt="Panel thumbnail A">
                        </div>
                        <div class="thumb-tile pf-card" data-thumb="2" data-card-id="2" title="Panel B">
                            <img src="https://im.runware.ai/image/ws/2/ii/0a56d500-319c-4650-a3f8-b60427281d4f.jpg" alt="Panel thumbnail B">
                        </div>
                        <div class="thumb-tile pf-card" data-thumb="3" data-card-id="3" title="Panel C">
                            <img src="https://im.runware.ai/image/ws/2/ii/0a56d500-319c-4650-a3f8-b60427281d4f.jpg" alt="Panel thumbnail C">
                        </div>
                        <div class="thumb-tile pf-card" data-thumb="4" data-card-id="4" title="Panel D">
                            <img src="https://im.runware.ai/image/ws/2/ii/0a56d500-319c-4650-a3f8-b60427281d4f.jpg" alt="Panel thumbnail D">
                        </div>
                        <div class="thumb-tile pf-card" data-thumb="5" data-card-id="5" title="Panel E">
                            <img src="https://im.runware.ai/image/ws/2/ii/0a56d500-319c-4650-a3f8-b60427281d4f.jpg" alt="Panel thumbnail E">
                        </div>
                        <div class="thumb-tile pf-card" data-thumb="6" data-card-id="6" title="Panel F">
                            <img src="https://im.runware.ai/image/ws/2/ii/0a56d500-319c-4650-a3f8-b60427281d4f.jpg" alt="Panel thumbnail F">
                        </div>
                    </div>

                    <!-- Page canvas / grid of panels (static placeholders) -->
                    <div class="page-canvas" role="region" aria-label="Storyboard canvas">
                        <div class="canvas-inner">
                            <div class="story-grid pf-grid" data-pf="grid" aria-hidden="false">
                                <!-- Main large panel -->
                                <div class="comic-panel main pf-card" data-panel="1" data-card-id="1">
                                    <img src="https://im.runware.ai/image/ws/2/ii/f4b413e2-1c2e-4833-9d39-d3e58a0adca7.jpg" alt="Main panel">
                                    <div class="panel-overlay">
                                        <button class="btn-regenerate-panel">? Regenerate</button>
                                    </div>
                                </div>

                                <!-- Right column: top -->
                                <div class="comic-panel top-right loading pf-card" data-panel="2" data-loading="true" data-card-id="2" aria-live="polite">
                                    <!-- skeleton to match design glowing loading -->
                                    <div class="skeleton" aria-hidden="true"></div>
                                    <div class="panel-overlay">
                                        <button class="btn-regenerate-panel">? Regenerate</button>
                                    </div>
                                </div>

                                <!-- Middle right stacked small panels -->
                                <div class="comic-panel middle-right pf-card" data-panel="3" data-card-id="3">
                                    <img src="https://im.runware.ai/image/ws/2/ii/0a56d500-319c-4650-a3f8-b60427281d4f.jpg" alt="Middle right panel">
                                    <div class="panel-overlay">
                                        <button class="btn-regenerate-panel">? Regenerate</button>
                                    </div>
                                </div>

                                <!-- Bottom right stacked small panels -->
                                <div class="comic-panel bottom-right loading pf-card" data-panel="4" data-loading="true" data-card-id="4">
                                    <div class="skeleton" aria-hidden="true"></div>
                                    <div class="panel-overlay">
                                        <button class="btn-regenerate-panel">? Regenerate</button>
                                    </div>
                                </div>
                            </div>

                            <!-- A mini grid below main area to mimic additional smaller panels (per design) -->
                            <div class="mini-grid" aria-label="Additional panels">
                                <div class="mini-panel pf-card" data-panel="5" data-card-id="5">
                                    <img src="https://im.runware.ai/image/ws/2/ii/0a56d500-319c-4650-a3f8-b60427281d4f.jpg" alt="Mini panel 1" style="width:100%;height:100%;object-fit:cover;display:block;">
                                </div>
                                <div class="mini-panel pf-card" data-panel="6" data-card-id="6">
                                    <img src="https://im.runware.ai/image/ws/2/ii/0a56d500-319c-4650-a3f8-b60427281d4f.jpg" alt="Mini panel 2" style="width:100%;height:100%;object-fit:cover;display:block;">
                                </div>
                                <div class="mini-panel pf-card" data-panel="7" data-card-id="7">
                                    <img src="https://im.runware.ai/image/ws/2/ii/0a56d500-319c-4650-a3f8-b60427281d4f.jpg" alt="Mini panel 3" style="width:100%;height:100%;object-fit:cover;display:block;">
                                </div>
                                <div class="mini-panel pf-card" data-panel="8" data-card-id="8">
                                    <img src="https://im.runware.ai/image/ws/2/ii/0a56d500-319c-4650-a3f8-b60427281d4f.jpg" alt="Mini panel 4" style="width:100%;height:100%;object-fit:cover;display:block;">
                                </div>
                                <div class="mini-panel pf-card" data-panel="9" data-card-id="9">
                                    <img src="https://im.runware.ai/image/ws/2/ii/0a56d500-319c-4650-a3f8-b60427281d4f.jpg" alt="Mini panel 5" style="width:100%;height:100%;object-fit:cover;display:block;">
                                </div>
                                <div class="mini-panel pf-card" data-panel="10" data-card-id="10">
                                    <img src="https://im.runware.ai/image/ws/2/ii/0a56d500-319c-4650-a3f8-b60427281d4f.jpg" alt="Mini panel 6" style="width:100%;height:100%;object-fit:cover;display:block;">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bottom paging & thumbnail strip (kept for navigation) -->
                    <nav class="page-navigation" aria-label="Page navigation" style="margin-top:0.5rem;">
                        <button class="page-btn active" aria-pressed="true">1</button>
                        <button class="page-btn">2</button>
                        <button class="page-btn">3</button>
                        <button class="page-btn">4</button>
                        <button class="page-btn">5</button>
                    </nav>

                    <input type="range" class="page-slider" min="1" max="5" value="1" aria-label="Page slider" style="margin-top:0.75rem;">

                    <div class="thumbnail-strip" aria-label="Storyboard pages">
                        <div class="thumbnail active" data-page="1">
                            <img src="https://im.runware.ai/image/ws/2/ii/0a56d500-319c-4650-a3f8-b60427281d4f.jpg" alt="Page 1 thumbnail">
                        </div>
                        <div class="thumbnail" data-page="2">
                            <img src="https://im.runware.ai/image/ws/2/ii/0a56d500-319c-4650-a3f8-b60427281d4f.jpg" alt="Page 2 thumbnail">
                        </div>
                        <div class="thumbnail" data-page="3">
                            <img src="https://im.runware.ai/image/ws/2/ii/0a56d500-319c-4650-a3f8-b60427281d4f.jpg" alt="Page 3 thumbnail">
                        </div>
                        <div class="thumbnail" data-page="4">
                            <img src="https://im.runware.ai/image/ws/2/ii/0a56d500-319c-4650-a3f8-b60427281d4f.jpg" alt="Page 4 thumbnail">
                        </div>
                        <div class="thumbnail" data-page="5">
                            <img src="https://im.runware.ai/image/ws/2/ii/0a56d500-319c-4650-a3f8-b60427281d4f.jpg" alt="Page 5 thumbnail">
                        </div>
                    </div>
                </div>

                <aside class="sidebar" aria-labelledby="sidebar-title">
                    <h2 id="sidebar-title" class="sidebar-title">Comments & Notes</h2>
                    <div class="notes-list">
                        <div class="note-item">
                            <div style="display:flex; gap:0.75rem; align-items:center; margin-bottom:0.5rem;">
                                <div class="note-avatar" aria-hidden="true"></div>
                                <div style="font-weight:600;">Story Note</div>
                            </div>
                            <div style="color:rgba(255,255,255,0.8); font-size:0.95rem;">Place notes for the storyboard here. Keep bright highlights for important directions.</div>
                        </div>
                        <div class="note-item">
                            <div style="display:flex; gap:0.75rem; align-items:center; margin-bottom:0.5rem;">
                                <div class="note-avatar" aria-hidden="true"></div>
                                <div style="font-weight:600;">Panel Feedback</div>
                            </div>
                            <div style="color:rgba(255,255,255,0.8); font-size:0.95rem;">Mark panels that need regenerating or additional detail.</div>
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </main>

    <script>
        (function() {
            'use strict';

            // Page navigation & thumbnails (preserve functionality from preview)
            const pageButtons = document.querySelectorAll('.page-btn');
            const pageSlider = document.querySelector('.page-slider');
            const thumbnails = document.querySelectorAll('.thumbnail');

            function setActivePage(pageNum) {
                pageButtons.forEach((btn, index) => {
                    btn.classList.toggle('active', index + 1 === pageNum);
                    btn.setAttribute('aria-pressed', String(index + 1 === pageNum));
                });
                thumbnails.forEach((thumb, index) => {
                    thumb.classList.toggle('active', index + 1 === pageNum);
                });
                if (pageSlider) pageSlider.value = pageNum;
            }

            pageButtons.forEach((btn, index) => {
                btn.addEventListener('click', function() {
                    setActivePage(index + 1);
                });
            });

            if (pageSlider) {
                pageSlider.addEventListener('input', function() {
                    setActivePage(parseInt(this.value));
                });
            }

            thumbnails.forEach((thumb, index) => {
                thumb.addEventListener('click', function() {
                    setActivePage(index + 1);
                    this.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
                });
            });

            // Top thumbnail strip interactions - center the clicked thumb and optionally highlight related panel
            const topThumbs = document.querySelectorAll('.thumb-tile');
            topThumbs.forEach((t) => {
                t.addEventListener('click', function() {
                    topThumbs.forEach(x => x.classList.remove('active'));
                    this.classList.add('active');
                    this.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
                });
            });

            // Regenerate buttons (top, page, panel)
            const regenerateTopBtn = document.querySelector('.btn-regenerate-top');
            const regeneratePageBtn = document.querySelector('.btn-regenerate-page');
            const regeneratePanelBtns = document.querySelectorAll('.btn-regenerate-panel');

            function showRegenerateMessage(target) {
                // Using simple alert for placeholder behavior; replace with app notification as needed
                alert(`Regenerating ${target}...`);
            }

            if (regenerateTopBtn) {
                regenerateTopBtn.addEventListener('click', () => showRegenerateMessage('storyboard'));
            }
            if (regeneratePageBtn) {
                regeneratePageBtn.addEventListener('click', () => showRegenerateMessage('page'));
            }
            regeneratePanelBtns.forEach((btn, index) => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showRegenerateMessage(`panel ${index + 1}`);
                });
            });

            // Zoom controls (preserve behavior)
            const zoomBtns = document.querySelectorAll('.zoom-btn');
            let zoomLevel = 1;
            zoomBtns.forEach((btn, index) => {
                btn.addEventListener('click', function() {
                    if (index === 0) {
                        zoomLevel = 1; // Fit to screen
                    } else if (index === 1) {
                        zoomLevel = Math.max(0.5, zoomLevel - 0.1); // Zoom out
                    } else if (index === 2) {
                        zoomLevel = Math.min(2, zoomLevel + 0.1); // Zoom in
                    }
                    const canvas = document.querySelector('.page-canvas');
                    if (canvas) {
                        canvas.style.transform = `scale(${zoomLevel})`;
                        canvas.style.transformOrigin = 'top center';
                    }
                });
            });

            // Download button (placeholder)
            const downloadBtn = document.querySelector('.btn-download');
            if (downloadBtn) {
                downloadBtn.addEventListener('click', () => {
                    alert('Downloading storyboard preview...');
                });
            }

            // Keyboard navigation
            document.addEventListener('keydown', (e) => {
                const currentPage = parseInt(pageSlider ? pageSlider.value : 1);
                const maxPage = pageButtons.length || 1;
                if (e.key === 'ArrowLeft' && currentPage > 1) {
                    setActivePage(currentPage - 1);
                } else if (e.key === 'ArrowRight' && currentPage < maxPage) {
                    setActivePage(currentPage + 1);
                }
            });

            // Toggle loading placeholders (new behavior)
            const toggleLoadingBtn = document.querySelector('.btn-toggle-loading');
            const loadingPanels = document.querySelectorAll('.comic-panel[data-loading="true"]');

            function setLoadingState(state) {
                // Toggles loading class on elements that were marked as data-loading
                loadingPanels.forEach(panel => {
                    panel.classList.toggle('loading', state);
                    // update aria attributes
                    if (state) {
                        panel.setAttribute('aria-busy', 'true');
                    } else {
                        panel.removeAttribute('aria-busy');
                    }
                });
                if (toggleLoadingBtn) {
                    toggleLoadingBtn.setAttribute('aria-pressed', String(state));
                }
            }

            // Initialize current state from panels: if any panel has loading class, consider toggled ON
            let initialLoading = false;
            loadingPanels.forEach(p => { if (p.classList.contains('loading')) initialLoading = true; });
            if (toggleLoadingBtn) {
                toggleLoadingBtn.setAttribute('aria-pressed', String(initialLoading));
            }

            // Attach toggle click
            if (toggleLoadingBtn) {
                toggleLoadingBtn.addEventListener('click', function() {
                    const pressed = this.getAttribute('aria-pressed') === 'true';
                    setLoadingState(!pressed);
                });
            }

            // Mini interaction: clicking a thumbnail in top strip highlights a panel (if matching data-thumb)
            topThumbs.forEach(t => {
                t.addEventListener('click', function() {
                    const id = this.getAttribute('data-thumb');
                    // Map to panels in a simple way (1->main, 2->top-right, 3->middle-right, 4->bottom-right)
                    const map = {
                        '1': '.comic-panel.main',
                        '2': '.comic-panel.top-right',
                        '3': '.comic-panel.middle-right',
                        '4': '.comic-panel.bottom-right',
                        '5': '.mini-panel[data-panel="5"]',
                        '6': '.mini-panel[data-panel="6"]'
                    };
                    const selector = map[id];
                    if (!selector) return;
                    const target = document.querySelector(selector);
                    if (target) {
                        // flash highlight
                        target.style.boxShadow = '0 0 0 4px rgba(6,182,212,0.14)';
                        setTimeout(() => { target.style.boxShadow = ''; }, 900);
                        target.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                });
            });

            // Accessibility: allow thumbnails to be focusable via keyboard
            document.querySelectorAll('.thumb-tile, .thumbnail').forEach(el => {
                el.setAttribute('tabindex', '0');
                el.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        el.click();
                    }
                });
            });

        })();
    </script>

    <script src="app.js" defer></script>
    <script>
        window.addEventListener('DOMContentLoaded', function() {
            if (window.app && typeof window.app.init === 'function') {
                try {
                    window.app.init(document);
                } catch (e) {
                    // non-fatal if app init fails
                    console.error('app.init error:', e);
                }
            }
        });
    </script>
</body>
</html>
